â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
              ESTRUCTURA DE TABLAS MAESTRAS/CATÃLOGOS - ERP HPyK
                          Datos de ConfiguraciÃ³n Base
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âš ï¸ IMPORTANTE: Las tablas maestras usan CODIGO (STRING) como PRIMARY KEY,
   NO usan ID autoincremental. Esto afecta cÃ³mo se cargan en los SELECT.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ TABLAS CON CODIGO COMO PRIMARY KEY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ PLANTA
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Primary Key: codigo (STRING 7)
  Campos: 
    - codigo: STRING(7) - PK
    - descripcion: TEXT

  âœ… CORRECTO en HTML:
    <option value="${planta.codigo}">${planta.descripcion}</option>

  âŒ INCORRECTO:
    <option value="${planta.id}">${planta.nombre}</option>

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ AREA
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Primary Key: codigo (STRING 2)
  Campos:
    - codigo: STRING(2) - PK
    - descripcion: TEXT

  âœ… CORRECTO en HTML:
    <option value="${area.codigo}">${area.descripcion}</option>

  âŒ INCORRECTO:
    <option value="${area.id}">${area.nombre}</option>

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ CATEGORIA
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Primary Key: codigo (STRING 3)
  Campos:
    - codigo: STRING(3) - PK
    - descripcion: TEXT
    - observacion: TEXT (nullable)

  âœ… CORRECTO en HTML:
    <option value="${categoria.codigo}">${categoria.descripcion}</option>


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š TABLAS CON ID AUTOINCREMENTAL (Tablas Principales)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ ALMACEN
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Primary Key: id (INTEGER autoincrement)
  Campos principales:
    - id: INTEGER - PK
    - codigo: STRING(20) - UNIQUE
    - nombre: STRING(100)
    - planta_id: STRING(7) - FK a planta.codigo
    - area_id: STRING(2) - FK a area.codigo

  âœ… CORRECTO en HTML:
    <option value="${almacen.id}">${almacen.nombre}</option>

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ PROVEEDOR
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Primary Key: id (INTEGER autoincrement)
  Campos principales:
    - id: INTEGER - PK
    - codigo: STRING
    - razon_social: STRING
    - ruc: STRING

  âœ… CORRECTO en HTML:
    <option value="${proveedor.id}">${proveedor.razon_social}</option>

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
â”‚ MATERIAL
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  Primary Key: id (INTEGER autoincrement)
  Campos principales:
    - id: INTEGER - PK
    - codigo_sap: STRING
    - nombre: STRING

  âœ… CORRECTO en HTML:
    <option value="${material.id}">${material.nombre}</option>


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ CORRECCIONES NECESARIAS EN LAS VISTAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ARCHIVOS QUE NECESITAN CORRECCIÃ“N:

1. âœ… src/vistas/logistica/almacenes.html
   - CORREGIDO: /api/plantas â†’ /api/catalogos/plantas
   - CORREGIDO: p.id/p.nombre â†’ p.codigo/p.descripcion

2. âš ï¸  src/vistas/mantenimiento/equipos.html
   - LÃ­nea 524: p.id, p.nombre â†’ p.codigo, p.descripcion
   - LÃ­nea 538: a.id, a.nombre â†’ a.codigo, a.descripcion

3. âš ï¸  src/vistas/catalogos/areas.html
   - LÃ­nea 270: p.id, p.nombre â†’ p.codigo, p.descripcion
   - LÃ­nea 295: area.nombre â†’ area.descripcion
   - LÃ­nea 342: area.nombre â†’ area.descripcion

4. âš ï¸  src/vistas/catalogos/plantas.html
   - LÃ­nea 288: planta.nombre â†’ planta.descripcion
   - LÃ­nea 335: planta.nombre â†’ planta.descripcion
   - LÃ­nea 298: editPlanta(planta.id) â†’ editPlanta(planta.codigo)
   - LÃ­nea 299: deletePlanta(planta.id) â†’ deletePlanta(planta.codigo)


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“¡ ENDPOINTS DE CATÃLOGOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

BASE URL: http://localhost:3000/api/catalogos

GET /plantas              â†’ Retorna: [{codigo: "PLANTA1", descripcion: "..."}, ...]
GET /plantas/:codigo      â†’ Retorna: {codigo: "PLANTA1", descripcion: "..."}
POST /plantas             â†’ Body: {codigo, descripcion}
PUT /plantas/:codigo      â†’ Body: {descripcion}
DELETE /plantas/:codigo

GET /areas                â†’ Retorna: [{codigo: "AR", descripcion: "..."}, ...]
GET /areas/:codigo        â†’ Retorna: {codigo: "AR", descripcion: "..."}
POST /areas               â†’ Body: {codigo, descripcion}
PUT /areas/:codigo        â†’ Body: {descripcion}
DELETE /areas/:codigo

GET /categorias           â†’ Retorna: [{codigo: "CAT", descripcion: "...", observacion: "..."}, ...]
GET /categorias/:codigo   â†’ Retorna: {codigo: "CAT", descripcion: "...", observacion: "..."}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¾ DATOS DE PRUEBA SUGERIDOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

-- PLANTAS
INSERT INTO planta (codigo, descripcion) VALUES 
  ('PLANTA1', 'Planta Principal Lima'),
  ('PLANTA2', 'Planta Secundaria Callao'),
  ('PLANTA3', 'Planta Norte Trujillo');

-- ÃREAS
INSERT INTO area (codigo, descripcion) VALUES 
  ('PR', 'ProducciÃ³n'),
  ('MN', 'Mantenimiento'),
  ('LG', 'LogÃ­stica'),
  ('CA', 'Calidad'),
  ('AD', 'AdministraciÃ³n');

-- CATEGORÃAS
INSERT INTO categoria (codigo, descripcion, observacion) VALUES 
  ('MAT', 'Materiales', 'Materias primas y suministros'),
  ('HER', 'Herramientas', 'Herramientas de trabajo'),
  ('REP', 'Repuestos', 'Repuestos para equipos');


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ PATRÃ“N DE CÃ“DIGO CORRECTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// âœ… CARGAR PLANTAS (Tabla Maestra)
async function loadPlantas() {
    try {
        const response = await fetch('/api/catalogos/plantas');
        const plantas = await response.json();
        const select = document.getElementById('planta_id');
        select.innerHTML = '<option value="">Seleccione planta...</option>';
        plantas.forEach(p => {
            select.innerHTML += `<option value="${p.codigo}">${p.descripcion}</option>`;
        });
    } catch (error) {
        console.error('Error cargando plantas:', error);
    }
}

// âœ… CARGAR ÃREAS (Tabla Maestra)
async function loadAreas() {
    try {
        const response = await fetch('/api/catalogos/areas');
        const areas = await response.json();
        const select = document.getElementById('area_id');
        select.innerHTML = '<option value="">Seleccione Ã¡rea...</option>';
        areas.forEach(a => {
            select.innerHTML += `<option value="${a.codigo}">${a.descripcion}</option>`;
        });
    } catch (error) {
        console.error('Error cargando Ã¡reas:', error);
    }
}

// âœ… CARGAR ALMACENES (Tabla Principal)
async function loadAlmacenes() {
    try {
        const response = await fetch('/api/logistica/almacenes');
        const almacenes = await response.json();
        const select = document.getElementById('almacen_id');
        select.innerHTML = '<option value="">Seleccione almacÃ©n...</option>';
        almacenes.forEach(a => {
            select.innerHTML += `<option value="${a.id}">${a.nombre}</option>`;
        });
    } catch (error) {
        console.error('Error cargando almacenes:', error);
    }
}

// âœ… RENDERIZAR TABLA DE PLANTAS
function renderTablaPlantas() {
    const tbody = document.getElementById('tableBody');
    tbody.innerHTML = '';
    plantas.forEach(planta => {
        tbody.innerHTML += `
            <tr>
                <td>${planta.codigo}</td>
                <td>${planta.descripcion}</td>
                <td>
                    <button onclick="editPlanta('${planta.codigo}')">Editar</button>
                    <button onclick="deletePlanta('${planta.codigo}')">Eliminar</button>
                </td>
            </tr>
        `;
    });
}

// âœ… EDITAR PLANTA (usando codigo, no id)
function editPlanta(codigo) {
    const planta = plantas.find(p => p.codigo === codigo);
    if (!planta) return;
    editingCodigo = codigo;  // NO editingId
    document.getElementById('codigo').value = planta.codigo;
    document.getElementById('descripcion').value = planta.descripcion;
}

// âœ… SUBMIT FORM PLANTA
async function submitPlanta(e) {
    e.preventDefault();
    const data = {
        codigo: document.getElementById('codigo').value,
        descripcion: document.getElementById('descripcion').value
    };
    
    const url = editingCodigo 
        ? `/api/catalogos/plantas/${editingCodigo}` 
        : '/api/catalogos/plantas';
    const method = editingCodigo ? 'PUT' : 'POST';
    
    const response = await fetch(url, {
        method: method,
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    });
    
    if (response.ok) {
        showToast('Planta guardada exitosamente');
        loadPlantas();  // âœ… ACTUALIZACIÃ“N AUTOMÃTICA
    }
}


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                         Fecha de actualizaciÃ³n: 10/02/2026
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
